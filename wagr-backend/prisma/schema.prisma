// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  DOG_OWNER
  SERVICE_PROVIDER
  BOTH
}

enum Gender {
  MALE
  FEMALE
}

enum SocializationLevel {
  BEGINNER
  INTERMEDIATE
  PRO
}

enum EventType {
  PLAYDATE
  PARTY
  TRAINING
  WALK
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum AdoptionStatus {
  AVAILABLE
  PENDING
  ADOPTED
  UNAVAILABLE
}

enum BreedingStatus {
  AVAILABLE
  IN_BREEDING
  UNAVAILABLE
}

model User {
  id                String   @id @default(cuid())
  email             String   @unique
  password          String
  firstName         String
  lastName          String
  phone             String?
  userType          UserType @default(DOG_OWNER)
  address           Json?
  isVerified        Boolean  @default(false)
  profilePhoto      String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  dogs              Dog[]
  events            Event[]
  serviceProvider   ServiceProvider?
  bookings          Booking[]
  reviews           Review[]
  posts             Post[]
  comments          Comment[]
  likes             Like[]
  applications      AdoptionApplication[]
  breedingRequests  BreedingRequest[]
  notifications     Notification[]
  carts             Cart[]
  orders            Order[]
  productReviews    ProductReview[]

  @@map("users")
}

model Dog {
  id                      String            @id @default(cuid())
  name                    String
  breed                   String
  birthDate               DateTime
  gender                  Gender
  medicalConditions       String[]
  furType                 String
  furColor                String
  socializationLevel      SocializationLevel @default(BEGINNER)
  vaccinations            Json?
  interests               String[]
  photos                  String[]
  isActive                Boolean           @default(true)
  isAvailableForBreeding  Boolean           @default(false)
  isForAdoption           Boolean           @default(false)
  weight                  Float?
  height                  Float?
  description             String?
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt

  // Relations
  ownerId                 String
  owner                   User              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  events                  Event[]
  breedingProfile         BreedingProfile?
  adoptionProfile         AdoptionProfile?
  bookings                Booking[]
  posts                   Post[]

  @@map("dogs")
}

model Event {
  id                      String            @id @default(cuid())
  title                   String
  description             String
  eventType               EventType
  startTime               DateTime
  endTime                 DateTime
  location                Json
  maxAttendees            Int               @default(10)
  allowedBreeds           String[]
  allowedSocializationLevels SocializationLevel[]
  isActive                Boolean           @default(true)
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt

  // Relations
  organizerId             String
  organizer               User              @relation(fields: [organizerId], references: [id], onDelete: Cascade)
  attendees               Dog[]

  @@map("events")
}

model ServiceProvider {
  id                      String   @id @default(cuid())
  businessName            String
  license                 String?
  serviceTypes            String[]
  experience              String?
  certifications          String[]
  insurance               String?
  backgroundCheck         String?
  serviceArea             Json
  availability            Json
  pricing                 Json
  specialServices         String[]
  emergencyProcedures     String?
  isVerified              Boolean @default(false)
  rating                  Float   @default(0)
  totalReviews            Int     @default(0)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  userId                  String @unique
  user                    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  bookings                Booking[]

  @@map("service_providers")
}

model Booking {
  id                      String        @id @default(cuid())
  startTime               DateTime
  endTime                 DateTime
  status                  BookingStatus @default(PENDING)
  totalPrice              Float
  notes                   String?
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt

  // Relations
  userId                  String
  user                    User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  dogId                   String
  dog                     Dog           @relation(fields: [dogId], references: [id], onDelete: Cascade)
  serviceProviderId       String
  serviceProvider         ServiceProvider @relation(fields: [serviceProviderId], references: [id], onDelete: Cascade)
  reviews                 Review[]

  @@map("bookings")
}

model Review {
  id                      String   @id @default(cuid())
  rating                  Int
  comment                 String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  userId                  String
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  bookingId               String
  booking                 Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

model BreedingProfile {
  id                      String         @id @default(cuid())
  status                  BreedingStatus @default(AVAILABLE)
  healthScreening         Json?
  geneticTests            Json?
  breedingHistory         Json?
  preferences             Json?
  isStud                  Boolean        @default(false)
  isBreedingFemale        Boolean        @default(false)
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt

  // Relations
  dogId                   String @unique
  dog                     Dog    @relation(fields: [dogId], references: [id], onDelete: Cascade)
  requests                BreedingRequest[]

  @@map("breeding_profiles")
}

model BreedingRequest {
  id                      String   @id @default(cuid())
  status                  String   @default("PENDING")
  message                 String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  requesterId             String
  requester               User    @relation(fields: [requesterId], references: [id], onDelete: Cascade)
  breedingProfileId       String
  breedingProfile         BreedingProfile @relation(fields: [breedingProfileId], references: [id], onDelete: Cascade)

  @@map("breeding_requests")
}

model AdoptionProfile {
  id                      String         @id @default(cuid())
  status                  AdoptionStatus @default(AVAILABLE)
  story                   String?
  specialNeeds            String[]
  adoptionFee             Float?
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt

  // Relations
  dogId                   String @unique
  dog                     Dog    @relation(fields: [dogId], references: [id], onDelete: Cascade)
  applications            AdoptionApplication[]

  @@map("adoption_profiles")
}

model AdoptionApplication {
  id                      String   @id @default(cuid())
  status                  String   @default("PENDING")
  message                 String?
  backgroundCheck         Json?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  applicantId             String
  applicant               User    @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  adoptionProfileId       String
  adoptionProfile         AdoptionProfile @relation(fields: [adoptionProfileId], references: [id], onDelete: Cascade)

  @@map("adoption_applications")
}

model Post {
  id                      String   @id @default(cuid())
  content                 String?
  media                   String[]
  hashtags                String[]
  isPublic                Boolean  @default(true)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  userId                  String
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  dogId                   String?
  dog                     Dog?     @relation(fields: [dogId], references: [id], onDelete: SetNull)
  comments                Comment[]
  likes                   Like[]

  @@map("posts")
}

model Comment {
  id                      String   @id @default(cuid())
  content                 String
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  userId                  String
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId                  String
  post                    Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("comments")
}

model Like {
  id                      String   @id @default(cuid())
  createdAt               DateTime @default(now())

  // Relations
  userId                  String
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId                  String
  post                    Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@map("likes")
}

model Notification {
  id                      String   @id @default(cuid())
  title                   String
  message                 String
  type                    String
  isRead                  Boolean  @default(false)
  createdAt               DateTime @default(now())

  // Relations
  userId                  String
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// Ecommerce Models

model Category {
  id                      String   @id @default(cuid())
  name                    String   @unique
  description             String?
  slug                    String   @unique
  image                   String?
  isActive                Boolean  @default(true)
  sortOrder               Int      @default(0)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  parentId                String?
  parent                  Category? @relation("CategoryChildren", fields: [parentId], references: [id])
  children                Category[] @relation("CategoryChildren")
  products                Product[]

  @@map("categories")
}

model Product {
  id                      String   @id @default(cuid())
  name                    String
  description             String
  sku                     String   @unique
  price                   Float
  comparePrice            Float?
  weight                  Float?
  dimensions              Json?
  images                  String[]
  tags                    String[]
  isActive                Boolean  @default(true)
  isDigital               Boolean  @default(false)
  requiresShipping        Boolean  @default(true)
  metaTitle               String?
  metaDescription         String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  categoryId              String
  category                Category @relation(fields: [categoryId], references: [id])
  variants                ProductVariant[]
  inventory               ProductInventory?
  cartItems               CartItem[]
  orderItems              OrderItem[]
  reviews                 ProductReview[]

  @@map("products")
}

model ProductVariant {
  id                      String   @id @default(cuid())
  name                    String
  sku                     String   @unique
  price                   Float
  comparePrice            Float?
  weight                  Float?
  dimensions              Json?
  image                   String?
  options                 Json     // {color: "red", size: "M"}
  isActive                Boolean  @default(true)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  productId               String
  product                 Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  inventory               VariantInventory?
  cartItems               CartItem[]
  orderItems              OrderItem[]

  @@map("product_variants")
}

model ProductInventory {
  id                      String   @id @default(cuid())
  quantity                Int      @default(0)
  reserved                Int      @default(0)
  lowStockThreshold       Int      @default(10)
  trackQuantity           Boolean  @default(true)
  allowBackorder          Boolean  @default(false)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  productId               String   @unique
  product                 Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_inventory")
}

model VariantInventory {
  id                      String   @id @default(cuid())
  quantity                Int      @default(0)
  reserved                Int      @default(0)
  lowStockThreshold       Int      @default(10)
  trackQuantity           Boolean  @default(true)
  allowBackorder          Boolean  @default(false)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  variantId               String   @unique
  variant                 ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@map("variant_inventory")
}

model Cart {
  id                      String   @id @default(cuid())
  sessionId               String?
  totalItems              Int      @default(0)
  totalAmount             Float    @default(0)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  userId                  String?
  user                    User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  items                   CartItem[]

  @@map("carts")
}

model CartItem {
  id                      String   @id @default(cuid())
  quantity                Int      @default(1)
  unitPrice               Float
  totalPrice              Float
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  cartId                  String
  cart                    Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId               String?
  product                 Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  variantId               String?
  variant                 ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@map("cart_items")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

model Order {
  id                      String        @id @default(cuid())
  orderNumber             String        @unique
  status                  OrderStatus   @default(PENDING)
  paymentStatus           PaymentStatus @default(PENDING)
  totalItems              Int
  subtotal                Float
  taxAmount               Float         @default(0)
  shippingAmount          Float         @default(0)
  discountAmount          Float         @default(0)
  totalAmount             Float
  currency                String        @default("USD")
  shippingAddress         Json
  billingAddress          Json?
  notes                   String?
  paymentIntentId         String?
  trackingNumber          String?
  shippedAt               DateTime?
  deliveredAt             DateTime?
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt

  // Relations
  userId                  String
  user                    User          @relation(fields: [userId], references: [id])
  items                   OrderItem[]
  payments                Payment[]

  @@map("orders")
}

model OrderItem {
  id                      String   @id @default(cuid())
  quantity                Int
  unitPrice               Float
  totalPrice              Float
  productName             String
  productImage            String?
  variantName             String?
  createdAt               DateTime @default(now())

  // Relations
  orderId                 String
  order                   Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId               String?
  product                 Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  variantId               String?
  variant                 ProductVariant? @relation(fields: [variantId], references: [id], onDelete: SetNull)

  @@map("order_items")
}

model Payment {
  id                      String        @id @default(cuid())
  amount                  Float
  currency                String        @default("USD")
  status                  PaymentStatus @default(PENDING)
  paymentMethod           String
  paymentIntentId         String?
  chargeId                String?
  refundId                String?
  failureReason           String?
  metadata                Json?
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt

  // Relations
  orderId                 String
  order                   Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model ProductReview {
  id                      String   @id @default(cuid())
  rating                  Int      // 1-5 stars
  title                   String?
  comment                 String?
  isVerified              Boolean  @default(false)
  isApproved              Boolean  @default(false)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  userId                  String
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId               String
  product                 Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("product_reviews")
}

// Admin Models

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  MODERATOR
  SUPPORT
}

model Admin {
  id                      String    @id @default(cuid())
  email                   String    @unique
  password                String
  firstName               String
  lastName                String
  role                    AdminRole @default(MODERATOR)
  isActive                Boolean   @default(true)
  lastLoginAt             DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  // Relations
  auditLogs               AuditLog[]

  @@map("admins")
}

model AuditLog {
  id                      String   @id @default(cuid())
  action                  String   // CREATE, UPDATE, DELETE, LOGIN, etc.
  entity                  String   // User, Product, Order, etc.
  entityId                String?
  oldValues               Json?
  newValues               Json?
  ipAddress               String?
  userAgent               String?
  createdAt               DateTime @default(now())

  // Relations
  adminId                 String
  admin                   Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@map("audit_logs")
}

model Analytics {
  id                      String   @id @default(cuid())
  event                   String   // page_view, product_view, purchase, etc.
  userId                  String?
  sessionId               String?
  metadata                Json?
  createdAt               DateTime @default(now())

  @@map("analytics")
}
